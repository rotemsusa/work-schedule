<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×¡×™×“×•×¨ ×¢×‘×•×“×” ×©×‘×•×¢×™</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Arial, 'Segoe UI', sans-serif;
      background: #2a2a2a;
      min-height: 100vh;
      padding: 10px;
    }

    /* ===== Login ===== */
    .login-container {
      max-width: 400px;
      margin: 50px auto;
      background: #f0f0f0;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
    }
    .login-container h1 { text-align: center; color: #2c3e50; margin-bottom: 10px; font-size: 22px; }
    .login-container .subtitle { text-align: center; color: #7f8c8d; margin-bottom: 25px; font-size: 14px; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #2c3e50; font-size: 14px; }
    .form-group select, .form-group input {
      width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 12px; font-size: 16px;
      transition: border-color 0.2s;
    }
    .form-group select:focus, .form-group input:focus { border-color: #666; outline: none; }
    .checkbox-group { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
    .checkbox-group input[type="checkbox"] { width: 20px; height: 20px; accent-color: #666; }
    .password-field { display: none; }
    .password-field.show { display: block; }
    .btn {
      width: 100%; padding: 14px; border: none; border-radius: 12px;
      font-size: 16px; font-weight: bold; cursor: pointer; color: white;
      background: #555;
      transition: transform 0.15s, box-shadow 0.15s;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
    .btn:active { transform: translateY(0); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
    .error-msg { color: #e74c3c; text-align: center; margin-top: 10px; display: none; font-size: 14px; }

    /* ===== App Container ===== */
    .app-container { display: none; max-width: 900px; margin: 0 auto; }
    .app-container.active { display: block; }

    /* ===== Combined Top Card ===== */
    .top-card {
      background: #e8e8e8; border-radius: 16px; padding: 12px 14px;
      margin-bottom: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .top-row-1 {
      display: flex; justify-content: space-between; align-items: center;
      gap: 8px; margin-bottom: 10px; direction: rtl;
    }
    .header-title-area {
      display: flex; align-items: center; gap: 8px; flex-shrink: 0;
    }
    .header-title-area .cbs-logo {
      width: 52px; height: 52px; object-fit: contain; flex-shrink: 0;
    }
    .top-card h1 {
      font-size: 15px; color: #222; margin: 0; white-space: nowrap;
    }
    .header-actions {
      display: flex; align-items: center; gap: 5px; flex-wrap: nowrap;
      overflow-x: auto; flex-shrink: 1; min-width: 0;
    }
    .header-actions > span#userName {
      font-size: 13px; font-weight: bold; color: #222; white-space: nowrap;
    }
    .user-badge {
      padding: 3px 8px; border-radius: 20px; font-size: 10px; font-weight: bold; color: white;
      white-space: nowrap; flex-shrink: 0;
    }
    .user-badge.employee { background: #666; }
    .user-badge.manager { background: #444; }
    .user-badge.admin { background: #333; }
    .btn-small {
      padding: 4px 10px; font-size: 11px; border-radius: 14px; border: 1.5px solid #bbb;
      cursor: pointer; background: white; color: #444; font-weight: bold;
      transition: all 0.2s; white-space: nowrap; flex-shrink: 0;
    }
    .btn-small:hover { background: #ddd; border-color: #999; }
    .btn-small.admin-btn {
      background: #444; color: white; border-color: transparent;
    }
    .btn-small.admin-btn:hover { opacity: 0.9; }
    .btn-small.btn-download {
      background: #555; color: white; border-color: #555; padding: 4px 8px;
    }
    .btn-small.btn-download:hover { background: #444; }

    .top-row-2 {
      display: flex; justify-content: space-between; align-items: center;
      gap: 6px; border-top: 1px solid #ccc; padding-top: 8px;
    }
    .week-btn {
      padding: 6px 14px; border: 1.5px solid #bbb; border-radius: 20px; font-weight: bold;
      cursor: pointer; background: #d8d8d8; color: #333; font-size: 13px;
      transition: all 0.2s; white-space: nowrap;
    }
    .week-btn:hover { background: #ccc; border-color: #999; }
    .week-title { font-weight: bold; color: #222; text-align: center; font-size: 13px; flex: 1; }

    @media (max-width: 480px) {
      .top-row-1 { flex-wrap: wrap; justify-content: center; }
      .header-title-area { width: 100%; justify-content: center; }
      .header-actions { width: 100%; justify-content: center; flex-wrap: wrap; }
    }

    /* ===== Schedule Card ===== */
    .schedule-card {
      background: #e8e8e8; border-radius: 16px; padding: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .legend {
      display: flex; flex-wrap: nowrap; gap: 8px; justify-content: center;
      margin-bottom: 12px; padding: 8px 10px; background: #d8d8d8; border-radius: 10px;
    }
    .legend-item {
      display: flex; align-items: center; gap: 4px; font-size: 12px; font-weight: bold; color: #333;
      white-space: nowrap;
    }
    .legend-color {
      width: 16px; height: 16px; border-radius: 4px; flex-shrink: 0;
    }

    /* ===== Employee Rows ===== */
    .employee-row {
      background: #d5d5d5;
      border: 1px solid #bbb;
      border-radius: 12px;
      margin-bottom: 10px;
      overflow: hidden;
      transition: box-shadow 0.2s;
    }
    .employee-row:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
    .employee-row.is-me {
      background: #c8c8c8;
      border-color: #888;
    }
    .employee-header {
      font-weight: bold;
      padding: 10px 14px;
      font-size: 15px;
      color: #222;
      border-bottom: 1px solid #bbb;
    }
    .employee-days {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      padding: 10px;
    }
    .day-cell {
      text-align: center;
    }
    .day-label {
      font-size: 11px;
      color: #888;
      margin-bottom: 5px;
      font-weight: 600;
    }
    .day-select {
      width: 100%;
      padding: 10px 4px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
      text-align: center;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      font-weight: 600;
      transition: transform 0.15s;
    }
    .day-select:not(:disabled):hover { transform: scale(1.05); }
    .day-select:disabled { cursor: not-allowed; opacity: 0.85; }
    
    /* Option colors */
    .day-select.empty { background-color: #c0c0c0; color: #777; }
    .day-select.office { background-color: #00e5ff; color: #111; }
    .day-select.home1 { background-color: #ffd700; color: #111; }
    .day-select.home2 { background-color: #ffd700; color: #111; }
    .day-select.vacation { background-color: #4cdf6b; color: #111; }
    .day-select.other { background-color: #ff6b9d; color: white; }

    .note-row {
      padding: 8px 10px;
      border-top: 1px dashed #ddd;
    }
    .note-input {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #999;
      border-radius: 10px;
      font-size: 14px;
      text-align: right;
      background: #e0e0e0;
      transition: border-color 0.2s;
    }
    .note-input:focus { border-color: #666; outline: none; }
    .note-input:disabled { background: #f5f5f5; opacity: 0.8; }

    /* ===== Status ===== */
    .status {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      padding: 10px 25px; border-radius: 25px; color: white; font-weight: bold;
      display: none; z-index: 1000; font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .status.saving { background: #f59e0b; display: block; }
    .status.saved { background: #10b981; display: block; }
    .status.error { background: #ef4444; display: block; }
    .status.offline { background: #6b7280; display: block; }

    /* ===== Loading ===== */
    .loading {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      display: none; justify-content: center; align-items: center; z-index: 2000;
    }
    .loading.show { display: flex; }
    .loading-box { background: #e0e0e0; padding: 30px; border-radius: 16px; text-align: center; }
    .spinner {
      width: 40px; height: 40px; border: 4px solid #ccc; border-top-color: #555;
      border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ===== Modal ===== */
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      display: none; justify-content: center; align-items: center; z-index: 3000; padding: 20px;
    }
    .modal.show { display: flex; }
    .modal-content {
      background: #e8e8e8; border-radius: 16px; padding: 25px; max-width: 500px; width: 100%;
      max-height: 80vh; overflow-y: auto;
    }
    .modal h2 { margin-bottom: 20px; color: #222; }
    .employee-list { margin-bottom: 20px; }
    .employee-item {
      display: flex; gap: 10px; align-items: center; margin-bottom: 10px;
      padding: 10px; background: #f8f9fa; border-radius: 10px;
    }
    .employee-item input { flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
    .employee-item button { padding: 8px 12px; border: none; border-radius: 8px; cursor: pointer; }
    .btn-delete { background: #ef4444; color: white; font-weight: bold; }
    .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; }
    .btn-cancel { background: #6b7280; color: white; padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
    .btn-save { background: #10b981; color: white; padding: 10px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>

  <!-- Login Screen -->
  <div class="login-container" id="loginScreen">
    <h1>ğŸ“… ×¡×™×“×•×¨ ×¢×‘×•×“×”</h1>
    <p class="subtitle">×‘×—×¨ ××ª ×©××š ×›×“×™ ×œ×”×™×›× ×¡</p>
    
    <div class="form-group">
      <label>×©× ×”×¢×•×‘×“:</label>
      <select id="employeeSelect">
        <option value="">×˜×•×¢×Ÿ...</option>
      </select>
    </div>

    <div class="checkbox-group">
      <input type="checkbox" id="isManagerCheck">
      <label for="isManagerCheck">×›× ×™×¡×” ×›×× ×”×œ / ×× ×”×œ ××¢×¨×›×ª</label>
    </div>

    <div class="form-group password-field" id="passwordField">
      <label>×¡×™×¡××”:</label>
      <input type="password" id="passwordInput" placeholder="×”×§×œ×“ ×¡×™×¡××”">
    </div>

    <button class="btn" id="loginBtn" disabled>×˜×•×¢×Ÿ...</button>
    <p class="error-msg" id="errorMsg">×¡×™×¡××” ×©×’×•×™×”</p>
  </div>

  <!-- Main App -->
  <div class="app-container" id="appContainer">
    <div class="top-card">
      <!-- Row 1: Logo + Title + User + Buttons -->
      <div class="top-row-1">
        <div class="header-title-area">
          <img class="cbs-logo" src="data:image/png;base64,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3r25/trryGuWr1eOvJKtW7dy/fU30L17d+3YoQOXXHIp48aO5d3p03nooYd01KhRkpudo5s2beKmG26gsF1bHTFihAAMO/MMCUfCWlGxjVHXXUdR2yK97rrrpNMhnfT6UaPo2KGjrl2zlo1dypgzezaHdT2MT2d9yjnnnMMfH3yArVsrGD/+dkpLS7nssss4+6yzeOO11/nl5VewdNUKTDxWy9DTT5MJd05k7TffAJCTnc3wCy+UVi1akp2TTWFhIS1atMCyLMLhMP2O6SdnnnUW27dvp2TOHM4/73yOO/54ufDii5k161Oat2pJi9atdjzf96i+cu5557JteyW2bRO2gxQXF8t5555LfX09M2fOYtiZZ3L8wAHyi5//grlzSiguLpaLR4yQojZFZOfl7gCjd+/e0vWww+h5RC8m3nmneA0ZEod06cxRRx8t7du359j+/RkwcID06NlTfvLTc+Sn553H3LlzGXTSSXLu+efLpZdcwpLFixlxyc+kbWEbfj9xgpw5bBhLFi1O0RLBABf/bISc/ZOfsOjzL3aJFs+/4Hz5+aWX8tn8+QCcceYZ8qsrr2TGjBm0a9eOyZMnE4vFGH7RcInV1HBo166ccuqpctHFF0lGOErzggJqqqoZcsop8ugTj4uxDMuXLVNzxeWXN3xDyMrKZtbMWTpm9E3MnDFDP1+4gFHXXy+33nqrXHvttRIOhVi+YgUACxYuoKB5c4qK2vLZ3HkAfDZ/PjnZ2dw4erSMHTdWotEoq1atAmDh55+TnZNNu3btWNnwjoWfLyQrK4uOHTowf8ECAEo+nU1h6+828d95+22u+OUVO41HVU0VVVVVDTRdyi6++950AaisrGTr5p1Pv8z8dCZti9p+R+15HuFQmA8/+kj/863yjRvJy83licce17Fjx6ZITMvaKfn78ccf1xtuuKFh28AiYH3HJn3wwQe0b9+eLl26sPqb1Xwyc4aUzJmjpWvWcNzxxwnAnx55RLOzsjhp8GC55qqreOWVVxQgEAik3tmsRYsddKaLYtsWhW0KWVtaSovCnS/RverqX8vU16Zpr27d1bIsJk+eLABH9y7WI3r01FAkwrTXX9uhY0f8bIS8+OIL2qtbd1XgmcnP0bdvX+ncubP2PLybusCU56dQXFwsz7/wvB7RvYfalsXTk58DYMaMGZqTn09x37473vnggw9qyZwSRt84OiX29zI9srKyiDupDaKxY27WadOm0a5DB269/bYdD3oClm0xt6SEbr168vRfJunTzz3LuFtvJRgK0axZMwBc2Xk/JRwOU1CQ4tkTnks0M5NJk57S++7+A83ymzHxrjsF4O+vv66DBw7S0g3rGTX6xh3t16xdS3G/owDIzM0hIxptkEcabgBS3anOmT1b+xX31e///t915oyZuutvM/bYZtbMXZ/f3W97e0dT64L5n+33d36/zps7b5dvzPj4k7S/u8sPJSUleky/Yw54Bw7WXev/BRznCv9O/akjAAAAAElFTkSuQmCC" alt="×œ××´×¡">
          <h1>×¡×™×“×•×¨ ×¢×‘×•×“×”</h1>
        </div>
        <div class="header-actions">
          <span id="userName">-</span>
          <span class="user-badge" id="userBadge">×¢×•×‘×“</span>
          <button class="btn-small admin-btn" id="manageEmployeesBtn" style="display:none;">× ×™×”×•×œ ×¢×•×‘×“×™×</button>
          <button class="btn-small" id="logoutBtn">×”×—×œ×£</button>
          <button class="btn-small btn-download" id="downloadImageBtn">ğŸ“·</button>
        </div>
      </div>

      <!-- Row 2: Week navigation -->
      <div class="top-row-2">
        <button class="week-btn" id="nextWeek">â† ×”×‘×</button>
        <span class="week-title" id="weekTitle">-</span>
        <button class="week-btn" id="prevWeek">×§×•×“× â†’</button>
      </div>
    </div>

    <div class="schedule-card">
      <div class="legend">
        <div class="legend-item"><div class="legend-color" style="background:#00e5ff;"></div><span>××©×¨×“</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#ffd700;"></div><span>×‘×™×ª 1</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#ffd700;"></div><span>×‘×™×ª 2</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#4cdf6b;"></div><span>×—×•×¤×©</span></div>
        <div class="legend-item"><div class="legend-color" style="background:#ff6b9d;"></div><span>××—×¨</span></div>
      </div>
      <div id="scheduleBody"></div>
    </div>
  </div>

  <!-- Status -->
  <div class="status" id="status"></div>

  <!-- Loading -->
  <div class="loading" id="loading">
    <div class="loading-box">
      <div class="spinner"></div>
      <div>×˜×•×¢×Ÿ...</div>
    </div>
  </div>

  <!-- Admin Modal -->
  <div class="modal" id="adminModal">
    <div class="modal-content">
      <h2>× ×™×”×•×œ ×¢×•×‘×“×™×</h2>
      <div class="employee-list" id="employeeList"></div>
      <button class="btn-small" id="addEmployeeBtn" style="margin-bottom:20px;">+ ×”×•×¡×£ ×¢×•×‘×“</button>
      <div class="modal-buttons">
        <button class="btn-cancel" id="cancelModal">×‘×™×˜×•×œ</button>
        <button class="btn-save" id="saveEmployees">×©××•×¨</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // ========== ×”×’×“×¨×•×ª ==========
    const API_URL = "https://script.google.com/macros/s/AKfycbwCGdiPKaZsuxwLTp3IzHJ-Ar2inf5C8tcYZgkUhs9nBtS2uU8Vz88WU87sIHaYE4TrsQ/exec";
    
    const PASSWORDS = {
      manager: "1234",
      admin: "admin123"
    };

    const DAYS = ["sunday", "monday", "tuesday", "wednesday", "thursday"];
    const DAY_NAMES = ["×'", "×‘'", "×’'", "×“'", "×”'"];

    // ========== ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ==========
    let currentUser = null;
    let currentWeekOffset = 0;
    let EMPLOYEES = {};
    let weekData = {};

    // ========== ××œ×× ×˜×™× ==========
    const $ = id => document.getElementById(id);
    const loginScreen = $("loginScreen");
    const appContainer = $("appContainer");
    const employeeSelect = $("employeeSelect");
    const isManagerCheck = $("isManagerCheck");
    const passwordField = $("passwordField");
    const passwordInput = $("passwordInput");
    const loginBtn = $("loginBtn");
    const errorMsg = $("errorMsg");
    const userName = $("userName");
    const userBadge = $("userBadge");
    const logoutBtn = $("logoutBtn");
    const weekTitle = $("weekTitle");
    const scheduleBody = $("scheduleBody");
    const statusEl = $("status");
    const loadingEl = $("loading");
    const manageEmployeesBtn = $("manageEmployeesBtn");
    const downloadImageBtn = $("downloadImageBtn");
    const adminModal = $("adminModal");

    // ========== ××ª×—×•×œ ==========
    async function init() {
      // ×˜×¢×™× ×ª ×¢×•×‘×“×™× ××”×©×¨×ª
      await loadEmployeesFromServer();
      
      // ×‘×“×™×§×” ×× ×™×© ××©×ª××© ×©××•×¨
      const saved = localStorage.getItem("schedule_user");
      if (saved) {
        try {
          currentUser = JSON.parse(saved);
          if (EMPLOYEES[currentUser.key]) {
            showApp();
          } else {
            localStorage.removeItem("schedule_user");
          }
        } catch (e) {
          localStorage.removeItem("schedule_user");
        }
      }

      // ××™×¨×•×¢×™×
      isManagerCheck.addEventListener("change", () => {
        passwordField.classList.toggle("show", isManagerCheck.checked);
        errorMsg.style.display = "none";
      });

      loginBtn.addEventListener("click", handleLogin);
      logoutBtn.addEventListener("click", handleLogout);
      $("prevWeek").addEventListener("click", () => changeWeek(-1));
      $("nextWeek").addEventListener("click", () => changeWeek(1));
      manageEmployeesBtn.addEventListener("click", openAdminModal);
      downloadImageBtn.addEventListener("click", downloadAsImage);
      $("cancelModal").addEventListener("click", closeAdminModal);
      $("saveEmployees").addEventListener("click", saveEmployeesToServer);
      $("addEmployeeBtn").addEventListener("click", addEmployeeRow);
    }

    // ========== ×˜×¢×™× ×ª ×¢×•×‘×“×™× ××”×©×¨×ª ==========
    async function loadEmployeesFromServer() {
      try {
        const response = await fetch(`${API_URL}?action=loadEmployees`);
        const data = await response.json();
        
        if (data.success && data.employees) {
          EMPLOYEES = data.employees;
        }
      } catch (e) {
        console.log("Failed to load employees from server");
        // ×‘×¨×™×¨×ª ××—×“×œ
        EMPLOYEES = {
          emp1: "×™×•×¡×™ ××–×¨×—×™",
          emp2: "××™×›×œ ×“×”×Ÿ",
          emp3: "××‘×™ ×©××©",
          emp4: "× ×•×¢×” ×‘×¨×§",
          emp5: "×¢×•××¨ ×’×•×œ×Ÿ"
        };
      }
      
      populateEmployeeSelect();
    }

    function populateEmployeeSelect() {
      employeeSelect.innerHTML = '<option value="">-- ×‘×—×¨ --</option>';
      Object.keys(EMPLOYEES).forEach(key => {
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = EMPLOYEES[key];
        employeeSelect.appendChild(opt);
      });
      loginBtn.disabled = false;
      loginBtn.textContent = "×›× ×™×¡×” ×œ××¢×¨×›×ª";
    }

    // ========== ×”×ª×—×‘×¨×•×ª ==========
    function handleLogin() {
      const empKey = employeeSelect.value;
      if (!empKey) {
        alert("×™×© ×œ×‘×—×•×¨ ×¢×•×‘×“");
        return;
      }

      let role = "employee";
      
      if (isManagerCheck.checked) {
        const pwd = passwordInput.value;
        if (pwd === PASSWORDS.admin) {
          role = "admin";
        } else if (pwd === PASSWORDS.manager) {
          role = "manager";
        } else {
          errorMsg.style.display = "block";
          return;
        }
      }

      currentUser = { key: empKey, name: EMPLOYEES[empKey], role: role };
      localStorage.setItem("schedule_user", JSON.stringify(currentUser));
      showApp();
    }

    function handleLogout() {
      localStorage.removeItem("schedule_user");
      currentUser = null;
      loginScreen.style.display = "block";
      appContainer.classList.remove("active");
      employeeSelect.value = "";
      isManagerCheck.checked = false;
      passwordField.classList.remove("show");
      passwordInput.value = "";
      errorMsg.style.display = "none";
    }

    function showApp() {
      loginScreen.style.display = "none";
      appContainer.classList.add("active");
      
      userName.textContent = currentUser.name;
      
      if (currentUser.role === "admin") {
        userBadge.textContent = "×× ×”×œ ××¢×¨×›×ª";
        userBadge.className = "user-badge admin";
        manageEmployeesBtn.style.display = "inline-block";
      } else if (currentUser.role === "manager") {
        userBadge.textContent = "×× ×”×œ";
        userBadge.className = "user-badge manager";
        manageEmployeesBtn.style.display = "none";
      } else {
        userBadge.textContent = "×¢×•×‘×“";
        userBadge.className = "user-badge employee";
        manageEmployeesBtn.style.display = "none";
      }

      updateWeekDisplay();
      loadWeekData();
    }

    // ========== × ×™×•×•×˜ ×©×‘×•×¢×•×ª ==========
    function getWeekDates(offset) {
      const today = new Date();
      const sunday = new Date(today);
      sunday.setDate(today.getDate() - today.getDay() + (offset * 7));
      const dates = [];
      for (let i = 0; i < 5; i++) {
        const d = new Date(sunday);
        d.setDate(sunday.getDate() + i);
        dates.push(d);
      }
      return dates;
    }

    function getWeekKey(offset) {
      const dates = getWeekDates(offset);
      const s = dates[0];
      return `${s.getFullYear()}-${s.getMonth() + 1}-${s.getDate()}`;
    }

    function formatDate(d) {
      return `${d.getDate()}/${d.getMonth() + 1}`;
    }

    function updateWeekDisplay() {
      const dates = getWeekDates(currentWeekOffset);
      const start = formatDate(dates[0]);
      const end = formatDate(dates[4]);
      
      let title = `${start} - ${end}`;
      if (currentWeekOffset === 0) title = `×”×©×‘×•×¢ ×”× ×•×›×—×™ (${title})`;
      else if (currentWeekOffset === 1) title = `×©×‘×•×¢ ×”×‘× (${title})`;
      else if (currentWeekOffset === -1) title = `×©×‘×•×¢ ×©×¢×‘×¨ (${title})`;
      
      weekTitle.textContent = title;
    }

    function changeWeek(delta) {
      currentWeekOffset += delta;
      updateWeekDisplay();
      loadWeekData();
    }

    // ========== ×˜×¢×™× ×ª × ×ª×•× ×™× ==========
    async function loadWeekData() {
      showLoading(true);
      
      const weekKey = getWeekKey(currentWeekOffset);
      weekData = {};
      
      // ××ª×—×•×œ ×¨×™×§ ×œ×›×œ ×”×¢×•×‘×“×™×
      Object.keys(EMPLOYEES).forEach(empKey => {
        weekData[empKey] = {};
      });
      
      try {
        const response = await fetch(`${API_URL}?action=loadWeek&week_key=${encodeURIComponent(weekKey)}`);
        const data = await response.json();
        
        if (data.success && data.requests) {
          data.requests.forEach(req => {
            const empKey = req.employee_key;
            const dayKey = req.day_key;
            if (weekData[empKey]) {
              weekData[empKey][dayKey] = req.choice_value || "";
              weekData[empKey][dayKey + "_other"] = req.choice_other || "";
            }
          });
        }
      } catch (e) {
        console.log("Failed to load week data");
        showStatus("error", "×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™×");
      }
      
      renderTable();
      showLoading(false);
    }

    // ========== ×¨×™× ×“×•×¨ ×˜×‘×œ×” ==========
    function renderTable() {
      const container = scheduleBody;
      container.innerHTML = "";
      
      const dates = getWeekDates(currentWeekOffset);
      
      Object.keys(EMPLOYEES).forEach(empKey => {
        const row = document.createElement("div");
        row.className = "employee-row";
        if (empKey === currentUser.key) {
          row.classList.add("is-me");
        }
        
        // ×©× ×”×¢×•×‘×“
        const header = document.createElement("div");
        header.className = "employee-header";
        header.textContent = EMPLOYEES[empKey] + (empKey === currentUser.key ? " (×× ×™)" : "");
        row.appendChild(header);
        
        // ×™××™×
        const daysContainer = document.createElement("div");
        daysContainer.className = "employee-days";
        
        let hasOther = false;
        let otherDayIdx = -1;
        let otherText = "";
        
        DAYS.forEach((day, idx) => {
          const dayCell = document.createElement("div");
          dayCell.className = "day-cell";
          dayCell.dataset.dayIdx = idx;
          
          // ×ª×•×•×™×ª ×™×•×
          const dayLabel = document.createElement("div");
          dayLabel.className = "day-label";
          dayLabel.textContent = DAY_NAMES[idx] + " " + formatDate(dates[idx]);
          dayCell.appendChild(dayLabel);
          
          // ×‘×—×™×¨×”
          const select = document.createElement("select");
          select.className = "day-select";
          select.dataset.emp = empKey;
          select.dataset.day = day;
          
          const currentValue = (weekData[empKey] && weekData[empKey][day]) || "";
          const currentOther = (weekData[empKey] && weekData[empKey][day + "_other"]) || "";
          const isOwnRow = empKey === currentUser.key;
          const isEmpty = currentValue === "";
          
          const canEdit = currentUser.role === "admin" || 
                          currentUser.role === "manager" || 
                          (isOwnRow && isEmpty);
          
          select.disabled = !canEdit;
          
          const options = [
            { value: "", label: "â€”", cls: "empty" },
            { value: "office", label: "××©×¨×“", cls: "office" },
            { value: "home1", label: "×‘×™×ª 1", cls: "home1" },
            { value: "home2", label: "×‘×™×ª 2", cls: "home2" },
            { value: "vacation", label: "×—×•×¤×©", cls: "vacation" },
            { value: "other", label: "××—×¨", cls: "other" }
          ];
          
          options.forEach(opt => {
            const o = document.createElement("option");
            o.value = opt.value;
            o.textContent = opt.label;
            select.appendChild(o);
          });
          
          select.value = currentValue;
          select.classList.add(options.find(o => o.value === currentValue)?.cls || "empty");
          
          select.addEventListener("change", (e) => handleCellChange(e, empKey, day, row, canEdit));
          
          dayCell.appendChild(select);
          daysContainer.appendChild(dayCell);
          
          // ×‘×“×™×§×” ×× ×™×© "××—×¨"
          if (currentValue === "other") {
            hasOther = true;
            otherDayIdx = idx;
            otherText = currentOther;
          }
        });
        
        row.appendChild(daysContainer);
        
        // ×©×•×¨×ª ×”×¢×¨×” ×× ×™×© "××—×¨"
        if (hasOther) {
          const noteRow = document.createElement("div");
          noteRow.className = "note-row";
          
          const isOwnRow = empKey === currentUser.key;
          const canEdit = currentUser.role === "admin" || 
                          currentUser.role === "manager" || 
                          isOwnRow;
          
          const noteInput = document.createElement("input");
          noteInput.type = "text";
          noteInput.className = "note-input";
          noteInput.placeholder = "×”×¢×¨×”...";
          noteInput.value = otherText;
          noteInput.disabled = !canEdit;
          noteInput.dataset.emp = empKey;
          noteInput.dataset.day = DAYS[otherDayIdx];
          noteInput.addEventListener("blur", (e) => handleOtherChange(e, empKey, DAYS[otherDayIdx]));
          
          noteRow.appendChild(noteInput);
          row.appendChild(noteRow);
        }
        
        container.appendChild(row);
      });
    }

    // ========== ×©××™×¨×ª ×ª× ==========
    async function handleCellChange(e, empKey, day, employeeRow, canEdit) {
      const select = e.target;
      const value = select.value;
      const weekKey = getWeekKey(currentWeekOffset);
      
      // ×¢×“×›×•×Ÿ ×¦×‘×¢
      select.className = "day-select " + (value ? value : "empty");
      
      // ×¢×“×›×•×Ÿ ××§×•××™
      if (!weekData[empKey]) weekData[empKey] = {};
      weekData[empKey][day] = value;
      
      if (value !== "other") {
        weekData[empKey][day + "_other"] = "";
      }
      
      // ×¨×¢× ×•×Ÿ ×©×•×¨×ª ×”×”×¢×¨×”
      const existingNote = employeeRow.querySelector(".note-row");
      if (value === "other" && !existingNote) {
        const noteRow = document.createElement("div");
        noteRow.className = "note-row";
        
        const noteInput = document.createElement("input");
        noteInput.type = "text";
        noteInput.className = "note-input";
        noteInput.placeholder = "×”×¢×¨×”...";
        noteInput.disabled = !canEdit;
        noteInput.dataset.emp = empKey;
        noteInput.dataset.day = day;
        noteInput.addEventListener("blur", (e) => handleOtherChange(e, empKey, day));
        
        noteRow.appendChild(noteInput);
        employeeRow.appendChild(noteRow);
        noteInput.focus();
      } else if (value !== "other" && existingNote) {
        let stillHasOther = false;
        DAYS.forEach(d => {
          if (weekData[empKey][d] === "other") stillHasOther = true;
        });
        if (!stillHasOther) {
          existingNote.remove();
        }
      }
      
      showStatus("saving", "×©×•××¨...");
      
      // ×©××™×¨×” ×œ×©×¨×ª
      await saveToServer(empKey, day, value, weekData[empKey][day + "_other"] || "");
    }
    
    async function handleOtherChange(e, empKey, day) {
      const input = e.target;
      const value = input.value;
      
      if (!weekData[empKey]) weekData[empKey] = {};
      weekData[empKey][day + "_other"] = value;
      
      showStatus("saving", "×©×•××¨...");
      
      await saveToServer(empKey, day, weekData[empKey][day], value);
    }
    
    async function saveToServer(empKey, day, choiceValue, choiceOther) {
      const weekKey = getWeekKey(currentWeekOffset);
      
      try {
        const payload = {
          employee_key: empKey,
          employee_name: EMPLOYEES[empKey],
          week_key: weekKey,
          day_key: day,
          choice_value: choiceValue,
          choice_other: choiceOther,
          updated_by: currentUser.key,
          updated_by_name: currentUser.name
        };
        
        const response = await fetch(`${API_URL}?action=upsertCell`, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify(payload)
        });
        
        const data = await response.json();
        if (data.success) {
          showStatus("saved", "× ×©××¨ âœ“");
        } else {
          showStatus("error", "×©×’×™××” ×‘×©××™×¨×”");
        }
      } catch (e) {
        showStatus("error", "×©×’×™××” ×‘×©××™×¨×”");
      }
    }

    // ========== Admin Modal ==========
    function openAdminModal() {
      const list = $("employeeList");
      list.innerHTML = "";
      
      Object.keys(EMPLOYEES).forEach(key => {
        addEmployeeRowToModal(key, EMPLOYEES[key]);
      });
      
      adminModal.classList.add("show");
    }

    function closeAdminModal() {
      adminModal.classList.remove("show");
    }

    function addEmployeeRow() {
      const newKey = "emp" + Date.now();
      addEmployeeRowToModal(newKey, "");
    }

    function addEmployeeRowToModal(key, name) {
      const list = $("employeeList");
      const div = document.createElement("div");
      div.className = "employee-item";
      div.dataset.key = key;
      div.innerHTML = `
        <input type="text" value="${name}" placeholder="×©× ×”×¢×•×‘×“">
        <button class="btn-delete" onclick="this.parentElement.remove()">××—×§</button>
      `;
      list.appendChild(div);
    }

    async function saveEmployeesToServer() {
      const items = $("employeeList").querySelectorAll(".employee-item");
      const newEmployees = {};
      
      items.forEach(item => {
        const key = item.dataset.key;
        const name = item.querySelector("input").value.trim();
        if (name) {
          newEmployees[key] = name;
        }
      });
      
      showStatus("saving", "×©×•××¨...");
      
      try {
        const response = await fetch(`${API_URL}?action=saveEmployees`, {
          method: "POST",
          headers: { "Content-Type": "text/plain;charset=utf-8" },
          body: JSON.stringify({ employees: newEmployees })
        });
        
        const data = await response.json();
        if (data.success) {
          EMPLOYEES = newEmployees;
          populateEmployeeSelect();
          closeAdminModal();
          
          if (EMPLOYEES[currentUser.key]) {
            currentUser.name = EMPLOYEES[currentUser.key];
            userName.textContent = currentUser.name;
            localStorage.setItem("schedule_user", JSON.stringify(currentUser));
          }
          
          loadWeekData();
          showStatus("saved", "× ×©××¨ âœ“");
        } else {
          showStatus("error", "×©×’×™××” ×‘×©××™×¨×”");
        }
      } catch (e) {
        showStatus("error", "×©×’×™××” ×‘×©××™×¨×”");
      }
    }

    // ========== ×¢×–×¨ ==========
    function showStatus(type, text) {
      statusEl.textContent = text;
      statusEl.className = "status " + type;
      
      if (type !== "saving") {
        setTimeout(() => {
          statusEl.className = "status";
        }, 3000);
      }
    }
    
    function showLoading(show) {
      loadingEl.classList.toggle("show", show);
    }

    // ========== ×”×•×¨×“×ª ×ª××•× ×” ==========
    async function downloadAsImage() {
      if (typeof html2canvas === 'undefined') {
        alert("×˜×•×¢×Ÿ... × ×¡×” ×©×•×‘ ×‘×¢×•×“ ×©× ×™×™×”");
        return;
      }
      
      showStatus("saving", "××›×™×Ÿ ×ª××•× ×”...");
      
      const weekKey = getWeekKey(currentWeekOffset);
      const dates = getWeekDates(currentWeekOffset);
      
      const container = document.createElement("div");
      container.style.cssText = "position: fixed; top: -9999px; left: -9999px; background: white; padding: 20px; border-radius: 15px; direction: rtl; font-family: Arial, sans-serif; min-width: 400px;";
      
      const title = document.createElement("div");
      title.style.cssText = "text-align: center; font-size: 24px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;";
      title.textContent = "ğŸ“… ×¡×™×“×•×¨ ×¢×‘×•×“×” - " + weekTitle.textContent;
      container.appendChild(title);
      
      const legend = document.createElement("div");
      legend.style.cssText = "display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; flex-wrap: wrap;";
      legend.innerHTML = `
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:20px;height:20px;background:#00e5ff;border-radius:5px;display:inline-block;"></span> ××©×¨×“</span>
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:20px;height:20px;background:#ffd700;border-radius:5px;display:inline-block;"></span> ×‘×™×ª 1</span>
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:20px;height:20px;background:#ffd700;border-radius:5px;display:inline-block;"></span> ×‘×™×ª 2</span>
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:20px;height:20px;background:#4cdf6b;border-radius:5px;display:inline-block;"></span> ×—×•×¤×©</span>
        <span style="display:flex;align-items:center;gap:5px;"><span style="width:20px;height:20px;background:#ff6b9d;border-radius:5px;display:inline-block;"></span> ××—×¨</span>
      `;
      container.appendChild(legend);
      
      const table = document.createElement("table");
      table.style.cssText = "width: 100%; border-collapse: collapse;";
      
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      ["×¢×•×‘×“", "×'", "×‘'", "×’'", "×“'", "×”'"].forEach((h, i) => {
        const th = document.createElement("th");
        th.style.cssText = "background: #555; color: white; padding: 10px; border: 1px solid #999;";
        if (i > 0) {
          th.innerHTML = h + "<br><small>" + formatDate(dates[i-1]) + "</small>";
        } else {
          th.textContent = h;
        }
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);
      
      const tbody = document.createElement("tbody");
      Object.keys(EMPLOYEES).forEach(empKey => {
        const tr = document.createElement("tr");
        
        const tdName = document.createElement("td");
        tdName.textContent = EMPLOYEES[empKey];
        tdName.style.cssText = "font-weight: bold; padding: 10px; border: 1px solid #ddd; background: #f8f9fa;";
        tr.appendChild(tdName);
        
        DAYS.forEach(day => {
          const td = document.createElement("td");
          td.style.cssText = "padding: 10px; border: 1px solid #ddd; text-align: center; font-weight: bold;";
          
          const value = (weekData[empKey] && weekData[empKey][day]) || "";
          const otherText = (weekData[empKey] && weekData[empKey][day + "_other"]) || "";
          
          if (value === "office") {
            td.style.background = "#00e5ff";
            td.style.color = "#111";
          } else if (value === "home1") {
            td.style.background = "#ffd700";
            td.style.color = "#111";
          } else if (value === "home2") {
            td.style.background = "#ffd700";
            td.style.color = "#111";
          } else if (value === "vacation") {
            td.style.background = "#4cdf6b";
            td.style.color = "#111";
          } else if (value === "other") {
            td.style.background = "#ff6b9d";
            td.style.color = "#ff6b9d";
          } else {
            td.style.background = "#e0e0e0";
            td.style.color = "#999";
          }
          
          tr.appendChild(td);
        });
        
        tbody.appendChild(tr);
      });
      
      table.appendChild(tbody);
      container.appendChild(table);
      
      const footer = document.createElement("div");
      footer.style.cssText = "text-align: center; font-size: 12px; color: #7f8c8d; margin-top: 15px;";
      footer.textContent = "×”×•×¤×§: " + new Date().toLocaleDateString("he-IL") + " " + new Date().toLocaleTimeString("he-IL");
      container.appendChild(footer);
      
      document.body.appendChild(container);
      
      try {
        const canvas = await html2canvas(container, { scale: 2, backgroundColor: "#ffffff" });
        const link = document.createElement("a");
        link.download = "×¡×™×“×•×¨_×¢×‘×•×“×”_" + weekKey.replace(/-/g, "_") + ".png";
        link.href = canvas.toDataURL("image/png");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showStatus("saved", "×”×ª××•× ×” ×”×•×¨×“×” âœ“");
      } catch (e) {
        console.error(e);
        showStatus("error", "×©×’×™××” ×‘×”×•×¨×“×ª ×”×ª××•× ×”");
      }
      
      document.body.removeChild(container);
    }

    // ========== ×”×ª×—×œ×” ==========
    init();
  </script>
</body>
</html>
